from tkinter import *
from tkinter.ttk import Combobox
from PIL import ImageTk, Image  
from deeppavlov import build_model
import numpy as np

#ПАРАМЕТРЫ НЕЙРОСЕТИ 2
INPUT_DIM = 6
OUT_DIM = 10
H_DIM = 20

#ВЕСА НЕЙРОСЕТИ 2
W1 = np.array([[-2.85490280e-01,-7.91660277e-02,2.57605696e-01,-3.99986041e-01,1.34871962e+00,-3.89678062e-01,1.89492711e+00,-2.05061984e-01,2.31562648e-02,-1.17681042e-01,-7.34500181e-01,-1.33832556e-01,-2.87304833e+00,1.97299843e-01,-3.99182973e-01,-4.80541023e-01,-1.56917405e-01,1.36009151e+00,5.67420262e-01,1.04331722e+00]
,[1.80434748e-01,-1.07184075e+00,-2.31768606e-01,-1.60448885e-01,1.43155934e+00,3.68543593e-01,-1.29236086e-01,5.96487558e-01,3.57454473e-02,3.51951928e-02,9.66364523e-01,3.44065560e-01,-3.01826138e+00,-2.41837553e-01,-9.56096898e-01,-1.25752118e+00,-3.82836709e-01,1.01410795e+00,4.48504981e-01,1.82960545e+00]
,[-1.80240758e-03,-4.44173040e-01,2.64317623e-01,1.10637725e-01,-6.65112536e-02,-4.75924500e-02,3.01069754e-01,-8.05048538e-02,-2.22969322e-01,1.16744411e-01,1.55965327e+00,-1.98803447e-01,3.61046907e-01,-2.15670569e-01,-4.10266251e-01,-6.13455436e-03,-2.68619308e-01,1.12473423e+00,7.79071231e-01,9.76651880e-01]
,[1.88256168e-01,1.25703364e+00,-2.73540123e-01,3.90762467e-01,-1.81827176e+00,3.10155481e-01,3.89745147e-02,2.39739614e-01,1.79128012e-01,-6.08030729e-02,1.75086564e+00,-5.88890647e-02,-9.79564315e-01,-6.93128557e-02,2.09692586e+00,9.18204972e-01,-1.02074871e-01,-4.66548413e-01,8.44170652e-01,-2.31152832e-01]
,[-3.75999083e-01,2.48949003e-01,-8.16130868e-02,-2.26477990e-01,7.35680480e-01,-3.07361929e-01,3.36909231e-02,1.87573805e-01,1.75951617e-01,2.20203045e-01,-2.99062318e-01,-7.55892432e-02,3.39779396e-01,1.41733346e-01,6.17448493e-01,3.49360296e-01,2.66310020e-01,-1.70450512e-01,4.32964035e-01,-3.44204040e-01]
,[-6.65295734e-02,-7.34764784e-01,-3.50884867e-01,-3.94988492e-01,2.05669664e+00,-4.02053317e-01,-1.05041802e+00,-3.50933739e-01,-3.68986331e-01,-3.90464011e-01,9.74293434e-01,-6.29411194e-02,1.23004463e+00,-1.61975841e-01,1.47714856e-01,3.92835756e+00,-3.12443929e-01,-7.85197335e-02,-1.34272047e+00,-3.54077625e-01]])

b1 =  np.array([[-0.35999864,3.76308013,-0.24316871,-0.02134639,-2.32282747,-0.00881032,2.06223717,0.31457043,-0.22935071,0.00849694,-0.62853915,-0.35868491,1.24993874,-0.2463492,0.21846539,-3.44781654,-0.25963334,1.45990951,7.08008877,1.77232171]])

W2 = np.array([[1.68277075e-01,-7.99382559e-02,9.81624766e-02,4.71288932e-02,-2.09971120e-01,1.92570255e-01,-1.23267088e-01,-3.43787359e-02,1.41346212e-01,-1.86708477e-01]
,[-1.84963677e+00,-4.34140424e-01,6.73872836e-01,2.05084103e+00,2.92145065e-01,-5.43253119e-01,2.03799567e+00,6.01201656e-01,-9.29758649e-01,-1.78298769e+00]
,[-1.57915449e-01,-1.74903482e-01,-1.61070431e-01,1.63607570e-01,1.64839675e-01,1.57935894e-01,7.99345755e-02,-2.79126634e-02,-1.99383879e-01,2.34393057e-02]
,[3.48340036e-02,1.21467691e-01,-1.01777529e-01,5.78599451e-02,1.69537127e-01,-4.97847095e-03,4.14175510e-02,1.00312829e-02,2.06402211e-01,1.77391563e-01]
,[8.70762543e-01,1.71483473e+00,-2.26929012e-01,-2.29479819e+00,1.88112793e-01,1.24963146e-01,-2.03747617e+00,-3.89936827e-01,-5.35275802e-01,1.84385074e+00]
,[1.45300723e-01,-8.12551700e-02,-6.28854883e-02,-5.78214633e-02,-2.00565799e-01,-6.12402037e-02,5.11064485e-02,-6.01494782e-02,-1.50122101e-01,-1.37863415e-01]
,[-8.33545809e-01,-1.38680044e+00,1.39082647e+00,8.10369179e-01,3.37913026e-01,-2.04060829e-01,-1.07478087e+00,1.46085229e+00,-2.17337926e-01,-3.76352062e-01]
,[-9.06540121e-02,4.98001853e-02,4.77539977e-01,-5.00577081e-02,1.73351274e-01,-3.28283436e-01,9.85444296e-02,1.22173736e-01,-1.14063228e-01,-1.15286175e-01]
,[1.52168175e-01,-1.43005807e-02,-1.67352579e-01,5.28284637e-02,1.63144092e-01,-6.44341149e-02,4.37060955e-02,1.26422644e-01,3.34875487e-02,2.11113242e-01]
,[1.10835606e-02,-1.71892197e-01,-1.35295598e-01,-1.70927834e-01,-1.75696700e-01,-5.40948818e-02,-5.42469554e-02,1.18347958e-01,8.72356006e-02,1.04883700e-01]
,[7.83078173e-02,1.86092389e-01,-9.99438673e-01,-1.49565315e-01,-4.87366905e-01,1.52263261e+00,-3.61431691e-01,-6.41280934e-01,1.76743639e+00,-9.03060769e-01]
,[-2.01672992e-01,-2.16240115e-01,-2.03409673e-02,1.04264226e-01,-6.98517033e-02,-1.66273982e-01,-7.10478764e-02,-9.60377556e-02,-7.44790936e-02,7.19419423e-02]
,[1.36352413e+00,-3.19066453e+00,-1.02760358e+00,1.09292177e+00,1.89750680e+00,3.80209803e-01,1.53190547e+00,-6.70848357e-01,-5.23645307e-01,-5.56317639e-01]
,[1.01853979e-01,-9.36831138e-03,1.82710674e-01,1.54603600e-01,5.91420458e-02,1.33263219e-02,1.98624969e-01,1.53474449e-01,-1.28410979e-01,1.05553078e-01]
,[-1.15626937e+00,-5.82684989e-01,-5.39083758e-01,8.09663559e-01,2.76529815e-01,-3.36251443e-01,8.80534881e-01,-1.50673979e-01,1.50013503e+00,-4.36169504e-01]
,[1.24944736e+00,5.38556914e-01,-3.73752293e+00,-1.75192044e+00,5.52909109e-01,-4.15000244e-01,2.70337773e-01,-1.01224387e+00,2.00436821e+00,2.33833895e+00]
,[-7.29425863e-02,1.65152964e-01,-1.17835975e-01,-3.36471096e-02,9.45224379e-02,3.95491605e-02,1.56313326e-01,8.10750567e-02,2.18721657e-01,-8.57450790e-03]
,[-5.51753634e-01,5.55009370e-01,7.23156136e-01,-9.90169090e-02,-8.88696209e-02,8.16325852e-01,-3.63684982e-01,1.41289220e+00,-1.16663638e+00,-9.81681544e-01]
,[-1.45628535e+00,-9.98488216e-01,2.58539165e+00,2.60029895e+00,4.93909653e-01,4.78994324e-01,1.77383408e+00,1.74359437e+00,-2.24574592e+00,-5.03882060e+00]
,[-4.79033887e-01,6.23203191e-01,1.42479453e+00,-1.87796379e-01,-3.56900173e-01,8.88320643e-01,-3.66546767e-01,9.73180163e-01,-6.70606321e-01,-1.84307991e+00]])

b2 =  np.array([[-0.01936826,-0.40290938,1.28236934,0.8584834,0.0416577,0.16215641,0.82588526,0.40971085,-1.19705573,-1.56665053]])

#ФУНКЦИИ НЕЙРОСЕТИ 2
def relu(t):
    return np.maximum(t, 0)

def softmax(t):
    out = np.exp(t)
    return out / np.sum(out)

def predict(x):
    t1 = x @ W1 + b1
    h1 = relu(t1)    
    t2 = h1 @ W2 + b2
    z = softmax(t2)
    return z

#DEEPPAVLOV ССЫЛКА НА МОДЕЛЬ
model = build_model("C:/Users/lipin/env2/Lib/site-packages/deeppavlov/configs/ner/ner_ontonotes_bert_mult.json")

#ОБРАБОТЧИК НАЖАТИЯ ДЛЯ КНОПКИ
def clicked():
    ZAPROS = [0, 0, 0, 0, 0, 0]
    #ПОЛУЧЕНИЕ ЗНАЧЕНИЯ ИЗ СПИСКА
    CBG=combo.get()
    if CBG=="Web-разработка":
        ZAPROS[5]=1
    elif CBG=="Mobile-разработка":
        ZAPROS[5]=2
    elif CBG=="Кибербезопасность":
        ZAPROS[5]=3
    elif CBG=="Машинное обучение":
        ZAPROS[5]=4
    elif CBG=="PC-разработка":
        ZAPROS[5]=5

    #ПОЛУЧЕНИЕ И ОБРАБОТКА DEEPPAVLOV ЗНАЧЕНИЯ ИЗ ПОЛЯ ВВОДА
    TEXT=txt.get()
    TEXT2=model([TEXT])
    print(TEXT2[1][0])
    i=0
    TT = TEXT2[1]
    while i < len(TT[0]):
        R = TT[0][i]
        if R == 'WEB': 
            ZAPROS[0]=1
        if R == 'MOB': 
            ZAPROS[1]=1
        if R == 'CS': 
            ZAPROS[2]=1
        if R == 'NN': 
            ZAPROS[3]=1
        if R == 'PC': 
            ZAPROS[4]=1
        i = i + 1    
    i=0    
    #ОБРАБОТКА ВСЕХ ДАННЫХ НЕЙРОСЕТЬЮ 2        
    probs = predict(ZAPROS)
    pred_class = np.argmax(probs)
    class_names = ['Салосятов Василий Евгеньевич', 'Фельдман Григорий Борисович', 'Андрей Владимирович Минкевич',
    'Александр Владимирович Бескодаров','Зейналов Алексей Руфатович','Юсифли Умид Бакихан оглы',
    'Александр Валерьевич Гаранин','Арсений Александрович Мясников','Матвеева Вера Петровна','Суржак Михаил Николаевич']
    
    #ВЫВОД РЕЗУЛЬТАТА
    lbl4.configure(text=ZAPROS)
    lbl5.configure(text=class_names[pred_class])
    

#ИНТЕРФЕЙС       
window = Tk()

# Задний фон
img =Image.open('Без имени-12.png')
bg = ImageTk.PhotoImage(img)
label = Label(window, image=bg)
label.place(x = -10,y = -10)

# Настройки окна
window.title("Добро пожаловать в приложение PythonRu")
window.geometry('375x370')
window.resizable(0, 0)

# Настройки текста
lbl1 = Label(window, text="Подберем научного руководителя по теме диплома")  
lbl1.place(x=25 ,y= 25, width=325)

# Настройки текста поля ввода
lbl2 = Label(window, text="Тема диплома")  
lbl2.place(x=25 ,y= 75)

# Настройки поля ввода
txt = Entry(window, width=10)
txt.place(x=25 ,y= 100, width=325, height=50)

# Настройки текста списка
lbl3 = Label(window, text="Направленность диплома")  
lbl3.place(x=25 ,y= 175)

# Настройки списка
combo = Combobox(window)
combo['values'] = ("","Web-разработка","Mobile-разработка","Кибербезопасность","Машинное обучение","PC-разработка") 
combo.current(0)
combo.place(x=25 ,y= 200, width=325)

# Настройки кнопки
btn = Button(window, text="Подобрать!", command=clicked)
btn.place(x=25 ,y= 275, width=325, height=22)

# Настройки текста результата
lbl4 = Label(window, text="Результат")  
lbl4.place(x=25 ,y= 300, width=325)

# Настройки текста преподователя
lbl5 = Label(window, text="Преподователь")  
lbl5.place(x=25 ,y= 325, width=325)

window.mainloop()
